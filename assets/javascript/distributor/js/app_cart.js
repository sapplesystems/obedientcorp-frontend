(function(app,jQuery){app.cart={init:function(){if(app.metaData.pageType!=='cart'){return}
app.cart.initFeatures();},cartItemsExist:function(){return!!(app.basket.data.exists&&app.basket.data.cartItems&&app.basket.data.cartItems.length);},setContent:function(couponStatus){var content=app.exports.cartComponents.getCart(app,couponStatus);if(app.cart.cartItemsExist()&&$('.js-cart-items').length){$('.js-cart-items').html(content);}else if(!app.cart.cartItemsExist()&&$('.js-no-cart-items').length){$('.js-no-cart-items').html(content);}else if(!app.cart.cartItemsExist()&&$('.js-cart-items').length){$('.js-cart').replaceWith('<div class="js-no-cart-items">'+content+'<div>');}else{window.location.reload();}
app.cart.initFeatures();},initFeatures:function(){app.cart.initAssetsSlots();if(app.cart.cartItemsExist()){app.cart.initPromos();app.cart.initRemove();app.cart.initQtyChange();app.cart.enableEdit.initOverlay();app.cart.initShipping();app.cart.initGiftWrap();app.cart.initMoveToWishList();app.cart.initCoupon();app.cart.initDeliveryPicker();app.cart.enableEmailMyCart.init();app.cart.initPayButtons();app.cxComponents.init();$.superCuteForms.wrap('.js-cart-items');if($('.js-modal').length){app.modal.api.close();}}
$(window).trigger('cart-update-complete');},initAssetsSlots:function(){if(!app.cart.cartItemsExist()){var emptyCartHtml=$('.js-cart-hidden-content div[data-cid="empty-cart"]').html();if(emptyCartHtml&&emptyCartHtml.trim()){$('span[data-cid="empty-cart"]').replaceWith(emptyCartHtml);}
var emptyCartQuery='.js-cart-hidden-content div[data-slotid="promo-cart-is-empty"]';var emptyCartPromoHtml=$(emptyCartQuery+' .emptyCartPromo').html();if(emptyCartPromoHtml&&emptyCartPromoHtml.trim()){$('span[data-slotid="promo-cart-is-empty"]').replaceWith($(emptyCartQuery).html());}}else{var freeShippingHtml=$('.js-cart-hidden-content div[data-slotid="cart-footer-free-economy-shipping"]').html();if(freeShippingHtml&&freeShippingHtml.trim()){$('span[data-slotid="cart-footer-free-economy-shipping"]').replaceWith(freeShippingHtml);}
var jibbitzHazardHtml=$('.js-cart-hidden-content div[data-cid="jibbitz-choking-hazard-message"]').html();if(jibbitzHazardHtml&&jibbitzHazardHtml.trim()){$('span[data-cid="jibbitz-choking-hazard-message"]').replaceWith(jibbitzHazardHtml);}
var shippingDescriptionHtml=$('.js-cart-hidden-content div[data-cid="cart-shipping-methods-description"]').html();if(shippingDescriptionHtml&&shippingDescriptionHtml.trim()){$('span[data-cid="cart-shipping-methods-description"]').replaceWith(shippingDescriptionHtml);}}
var request={type:"GET",url:(app.globals.urls.pageSlot+'?slotID=emptycart-recs')};$.ajax(request).done(function(slotHTML){if(slotHTML){$('div[data-slotid="recs-cart-is-empty"]').replaceWith(slotHTML);}});},initPayButtons:function(){var noInvalidProduct=true;var cartItems=app.basket.data.cartItems;for(var i=0,len=cartItems.length;i<len;i++){if(!cartItems[i].ats){noInvalidProduct=false;break;}}
$('.btn_placeOrder').on('click',function(){if(noInvalidProduct){window.location=app.globals.urls.cartStartCheckout;}});$('.paypal_checkout_btn').on('click',function(){if(noInvalidProduct){window.location=app.globals.urls.paypalExpress;}});try{var cartNavButtons=$(".cartNavButtons")[0],checkoutButtonsObserver=new MutationObserver(checkoutButtonsMutation);checkoutButtonsObserver.observe(cartNavButtons,{childList:true});function checkoutButtonsMutation(mutations){for(var i=0;i<mutations.length;i++){if(mutations[i].type=="childList"&&typeof mutations[i].addedNodes=="object"){var $node=$(mutations[i].addedNodes);if($node.length==1&&$node.attr("id")=="apple-pay-button"){$('.cartNavSep').removeClass('d-none');$node.html(app.util.getApplePayButton());$(window).trigger('apple-pay-enabled');$(window).trigger('apple-pay-button-available');$node.click(function(){$(window).trigger('apple-pay-button-clicked');});}}}}}catch(err){}},initDeliveryPicker:function(){if(!app.globals.sitePrefs.enableDeliveryPicker){return}
var $date=$('#delivery-date');var $time=$('#delivery-time');$.each($('button[data-cid="delivery_pick_note"]'),function(){var $elem=$('.js-cart-hidden-content div[data-cid="delivery_pick_note"]');if($elem.html().trim()){var $this=$(this);$this.removeClass('d-none');app.modal.api.init({errorMsg:"Sorry, content not found",adaTitle:"modal",$elem:$elem,$trigger:$this});}});if(app.basket.data.deliveryDate===null){app.basket.api.setDelivery('00','00',['approaching','promos','shipping','delivery']);}
if(app.basket.data.deliveryTime&&$time.find('option[value="'+app.basket.data.deliveryTime+'"]').length){$time.val(app.basket.data.deliveryTime);}
if(app.basket.data.deliveryDate&&$date.find('option[value="'+app.basket.data.deliveryDate+'"]').length){$date.val(app.basket.data.deliveryDate);}
if($date.val()==='00'||!$date.val()){$date.val('00');$time.val('00');$time.addClass('disabled');$time.attr('disabled','disabled');}
$('#delivery-date, #delivery-time').off('change',updateDelivery);$('#delivery-date, #delivery-time').on('change',updateDelivery);function updateDelivery(){if(!isValidDeliveryDate($date,$time)){$date.val('00');$time.val('00');$time.addClass('disabled');$time.attr('disabled','disabled');}else{$time.removeClass('disabled');$time.removeAttr('disabled');}
app.basket.api.setDelivery($time.val(),$date.val(),['approaching','promos','shipping','delivery'],function(){app.cart.setContent();});}
function isValidDeliveryDate($date,$time){var dates=[],times=[];$.each($('#delivery-date option'),function(){dates.push($(this).attr('value'))});$.each($('#delivery-time option'),function(){times.push($(this).attr('value'))});if($date.val()==='00'||!$date.val()||(dates.indexOf($date.val())===-1||times.indexOf($time.val())===-1)){return false;}
return true;}},initGiftWrap:function(){$.each($('a[data-cid="gift_wrap_info"]'),function(){var $elem=$('.js-cart-hidden-content div[data-cid="gift_wrap_info"]');if($elem.html().trim()){var $this=$(this);$this.removeClass('d-none');app.modal.api.init({errorMsg:"Sorry, content not found",adaTitle:"modal",$elem:$elem,$trigger:$this});}});$('#giftWrap input').off('change',toggleGiftWrap);$('#giftWrap input').on('change',toggleGiftWrap);function toggleGiftWrap(){if($("#giftWrap input:checked").length){app.basket.api.addGiftWrap(['approaching','promos','shipping','delivery'],function(){app.cart.setContent();});}else{app.basket.api.removeGiftWrap(['approaching','promos','shipping','delivery'],function(){app.cart.setContent();});}}},initShipping:function(){$.each($('a[data-cid="cart-shipping-methods-description"]'),function(){var $elem=$('.js-cart-hidden-content div[data-cid="cart-shipping-methods-description"]');if($elem.html().trim()){var $this=$(this);$this.removeClass('d-none');app.modal.api.init({errorMsg:"Sorry, content not found",adaTitle:"modal",$elem:$elem,$trigger:$this});}});$('#cart_select_shipping_method_box').off('change',changeShipMethod);$('#cart_select_shipping_method_box').on('change',changeShipMethod);function changeShipMethod(){app.basket.api.setShipping($(this).val(),['approaching','promos','shipping','delivery'],function(){app.cart.setContent();});}},initPromos:function(){$.each($('a[data-promodetaillink]'),function(){var $this=$(this);var promoID=$this.attr('data-promodetaillink');var $elem=$($('div[data-promodetail="'+promoID+'"]')[0]);app.modal.api.init({errorMsg:"Sorry, content not found",adaTitle:"modal",$trigger:$this,ajax:$this.data('disclaimerlink')});});$('.removecoup').off('click',remove);$('.removecoup').on('click',remove);function remove(){var $this=$(this);var uuid=$this.attr('data-uuid');app.basket.api.removeCoupon(uuid,['approaching','promos','shipping','delivery'],function(){app.cart.setContent();});}},initQtyChange:function(){$('.quantInput').on('change',updateInput);$('.qtyminus').on('click',removeAction);$('.qtyplus').on('click',addAction);var cartItems=app.basket.data.cartItems;var pid,sizeLabel;function updateInput(e){var fieldName=$(this).attr('field');var uuid=$(this).attr('data-uuid');var qty=$(this).val();for(var i=0,len=cartItems.length;i<len;i++){if(cartItems[i].uuid===uuid){pid=cartItems[i].id;sizeLabel=cartItems[i].sizeDisplay?cartItems[i].sizeDisplay:'';break;}}
if(qty===0){app.basket.api.remove(uuid,['approaching','promos','shipping','delivery'],function(){app.cart.setContent();});}else{app.basket.api.update(uuid,pid,qty,sizeLabel,['approaching','promos','shipping','delivery'],function(){var buttonID=$(".cartProductsContainer :focus").attr("id");app.cart.setContent();buttonID&&$("[id="+buttonID+"]").focus();});}}
function addAction(e){var fieldName=$(this).attr('field');var uuid=$(this).attr('data-uuid');var $qtyField=$('input[name='+fieldName+'][data-uuid ='+uuid+']');$qtyField.val(parseInt($qtyField.val())+1).change();}
function removeAction(e){var fieldName=$(this).attr('field');var uuid=$(this).attr('data-uuid');var $qtyField=$('input[name='+fieldName+'][data-uuid ='+uuid+']');$qtyField.val(parseInt($qtyField.val())-1).change();if($qtyField.val()==0){app.basket.api.remove(uuid,['approaching','promos','shipping','delivery'],function(){app.cart.setContent();});}}},initRemove:function(){$('.removeItem').off('click',remove);$('.removeItem').on('click',remove);function remove(){var uuid=$(this).attr('data-uuid');app.basket.api.remove(uuid,['approaching','promos','shipping','delivery'],function(){app.cart.setContent();});}},initMoveToWishList:function(){$('.wishMove').off('click',move);$('.wishMove').on('click',move);function move(){var uuid=$(this).attr('data-uuid');function triggerMoveToWishlist(){app.basket.api.moveToWishlist(uuid,['approaching','promos','shipping','delivery'],function(){app.cart.setContent();});}
if(!app.customer||!app.customer.authenticated){app.auth.openPopup("login","","",function(){$.colorbox.close();triggerMoveToWishlist();});}else{triggerMoveToWishlist();}}},enableEdit:{initOverlay:function(){app.cart.enableEdit.editAttributes={};var cartItems=app.basket.data.cartItems;$('a.editItem').off('click',edit);$('a.editItem').on('click',edit);function edit(ev){var uuid=app.cart.enableEdit.editAttributes.uuid=$(this).attr('data-uuid');for(var i=0,len=cartItems.length;i<len;i++){if(cartItems[i].uuid===uuid){app.cart.enableEdit.editAttributes.qty=cartItems[i].qty;app.cart.enableEdit.editAttributes.sizeLabel=cartItems[i].sizeDisplay?cartItems[i].sizeDisplay:'';break;}}
initModal(ev);}
function initModal(ev){app.modal.api._stopEvents(ev);if(ev.type=='keypress'&&$target.is('a, button, input')){return};var pid=$(ev.target).closest('.js-productContainer').attr('data-pid');var options={isCartEdit:true,isQuickView:false,ev:ev,pageUniqueID:'qv',sid:app.cart.enableEdit.editAttributes.sizeLabel,pid:pid,pidMaster:$(ev.target).closest('.js-productContainer').attr('data-pidmaster'),cid:/-/.test(pid)?pid.split('-')[1]:null,template:'quickView',destinationClass:'js-modal-content',addClass:"quick-view-modal"};app.modal.api.init({source:'cart',openNow:true,$trigger:$(ev.target),addClass:options.addClass,adaTitle:app.globals.msgs.editCart});app.modal.api.populateProductModal(options);}},executeEdit:function(pid,sizeLabel){var attr=app.cart.enableEdit.editAttributes;app.basket.api.update(attr.uuid,pid,attr.qty,(sizeLabel?sizeLabel:attr.sizeLabel),['approaching','promos','shipping','delivery'],function(){if(!status){app.modal.api.init({openNow:true,ajax:app.globals.urls.pageInclude+"?cid=oosMessage",$trigger:$("<a></a>")});}
app.cart.setContent();});}},initCoupon:function(){var $couponFld=$('#couponFld');$("#couponHeaderLink").on('click',function(){$("#couponField").show();});$couponFld.on('keyup blur focus',function(){if(app.globals.sitePrefs.autoUppercaseCouponField&&$couponFld.val().trim()){$(this).addClass('text-uppercase');}else{$(this).removeClass('text-uppercase');}});$('#addcoup').on('click keypress',function(e){if(e.type=='keypress'&&$(e.target).is('a, button, input')){return};if(app.globals.sitePrefs.autoUppercaseCouponField&&$couponFld.val()!=app.globals.msgs.couponEnter){$couponFld.val($couponFld.val().toUpperCase());}
app.basket.api.addCoupon($couponFld.val(),['approaching','promos','shipping','delivery'],function(){var couponStatus=arguments&&arguments[0].hasOwnProperty('success')?arguments[0]:null;var focusedID=$(".shoppingCartContainer :focus").attr("id");app.cart.setContent(couponStatus);$("[id="+focusedID+"]").focus();app.cxComponents.init();});});$('.removecoup').on('click',function(e){var uuid=$(this).attr('data-uuid');app.basket.api.removeCoupon(uuid,['approaching','promos','shipping','delivery'],function(){app.cart.setContent();});});},highlight:function(coupon){$elems=coupon?$('#giftWrap, .js-estimatedTotal, .js-taxes, .couponAppliedList'):$('#giftWrap, .js-estimatedTotal, .taxes');$elems.addClass("highlight");setTimeout(function(){$elems.removeClass("highlight");},3000);},enableEmailMyCart:{isInit:false,init:function(){if(!app.globals.sitePrefs.enableEmailMyCart||!app.globals.urls.reCaptchaJs||!app.cart.cartItemsExist()){return}
$('#cart-footer-side_email-my-cart_body').html(app.cart.enableEmailMyCart.getHTML());if(app.cart.enableEmailMyCart.isInit===false){app.reCaptcha.initReCaptcha();$(window).on('reCaptchaCallbackEvent',reCaptchaCallbackEvent);function reCaptchaCallbackEvent(){app.reCaptcha.render('emailMyCartCaptcha',app.cart.enableEmailMyCart.initEvents);}
app.cart.enableEmailMyCart.isInit=true;}else{try{grecaptcha.reset(app.reCaptcha.captcha['emailMyCartCaptcha'].grecaptcha);app.reCaptcha.render('emailMyCartCaptcha',app.cart.enableEmailMyCart.initEvents);}catch(e){console.error('reCaptcha reset fail: '+e);}}},initEvents:function(){var $emailMyCartNav=$('.cart-footer-side_email-my-cart_nav');$emailMyCartNav.off('click',emailMyCartClick);$emailMyCartNav.on('click',emailMyCartClick);function emailMyCartClick(){var $emailMyCartBody=$(".cart-footer-side_email-my-cart_body"),$emailMyCartArrow=$(".email-my-cart_arrow");$emailMyCartBody.toggle();if($emailMyCartBody.css('display')==='none'){$emailMyCartNav.attr('aria-expanded','false');$emailMyCartArrow.removeClass('email-my-cart_arrow-up');}else{$emailMyCartNav.attr('aria-expanded','true');$emailMyCartArrow.addClass('email-my-cart_arrow-up');}}
$('.email-my-cart_button').on("click",function(e){var email=$('.email-my-cart_email-address_input').val(),isEmailValid=/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/.test(email);var grecaptchaResponse=grecaptcha&&grecaptcha.getResponse(app.reCaptcha.captcha['emailMyCartCaptcha'].grecaptcha);if(email&&isEmailValid&&grecaptchaResponse){var comment=$('.email-my-cart_comment_textarea').val();$('.email-my-cart_invalid-email,.email-my-cart_invalid-captcha').hide();$.ajax({'type':"POST",'url':app.globals.urls.emailMyCart,'data':{email:encodeURIComponent(email),comment:encodeURIComponent(comment),captcharesponse:grecaptchaResponse},'success':function(response){$('.cart-footer-side_email-my-cart_body').html(app.cart.enableEmailMyCart.getHTML(response));$(window).trigger('emailMyCart-success');},'error':function(response){$('.email-my-cart_invalid-captcha').show();$(window).trigger('emailMyCart-fail');}});}else{$('.email-my-cart_invalid-email,.email-my-cart_invalid-captcha').hide();if(!email||!isEmailValid){$('.email-my-cart_invalid-email').show();$(window).trigger('emailMyCart-fail-email');}else{$('.email-my-cart_invalid-captcha').show();$(window).trigger('emailMyCart-fail-captcha');}}});},getHTML:function(data){if(data&&data.EmailSubmitted){return '<div class="email-my-cart_success text-bold">'+app.globals.msgs.cart.emailmycartEmailsent+'</div>';}else{var showEmailError=data&&(data.EmailAddress!==''&&data.IsEmailValid===false);var showCaptchaError=data&&(data.CaptchaResponse!==''&&data.isCaptchaValid===false);return ''+
'<form style="width: 304px;margin: 0 auto;" class="email-my-cart recaptcha" action="javascript:void(0)">'+
'<label class="email-my-cart_email-address_label" for="email-my-cart_email-address_input"><span class="text-red" aria-hidden="true">*</span>'+app.globals.msgs.cart.emailmycartEmail+'</label>'+
'<input autocorrect="off" autocapitalize="off" class="email-my-cart_email-address_input" id="email-my-cart_email-address_input" type="email" name="email-my-cart_email-address">'+
'<div class="email-my-cart_invalid-email error" style="'+(showEmailError?'':'display:none;')+'">'+app.globals.msgs.cart.emailmycartInvalidemail+'</div>'+
'<label class="email-my-cart_comment_label" for="email-my-cart_comment_textarea">'+app.globals.msgs.cart.emailmycartComments+'</label>'+
'<textarea rows="3" class="email-my-cart_comment_textarea" id="email-my-cart_comment_textarea" type="text" name="email-my-cart_comment"></textarea>'+
'<div id="emailMyCartCaptcha"></div>'+
'<div class="email-my-cart_invalid-captcha error" style="'+(showCaptchaError?'':'display:none;')+'">'+app.globals.msgs.cart.emailmycartInvalidcaptcha+'</div>'+
'<button type="button" id="email-my-cart_button" class="email-my-cart_button medButton text-bold text-white"><span>'+app.globals.msgs.cart.emailmycartSend+'</span></button>'+
'</form>';}}}}})(app,jQuery);